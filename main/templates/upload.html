{% extends "base.html" %}
{% block content %}
<title>Upload Product</title>

<div class="container mt-4" style="padding: 50px; box-shadow: 2px 4px 6px gray;">
  <h2 style="text-align: center; font-weight: bold; color: black;">Upload Product</h2>

  <form id="productForm">
    <div class="container mt-4" style="color: black;">
      {% csrf_token %}
      <div class="mb-3">
        {{ form.name.label_tag }}
        {{ form.name }}
      </div>
      <div class="mb-3">
        {{ form.category.label_tag }}
        {{ form.category }}
      </div>
      <div class="mb-3">
        {{ form.price.label_tag }}
        {{ form.price }}
      </div>
      <div class="mb-3">
        {{ form.description.label_tag }}
        {{ form.description }}
      </div>
      <div class="mb-3">
        {{ form.thumbnail.label_tag }}
        {{ form.thumbnail }}
      </div>

      <div class="d-flex mb-3 gap-2 align-items-center">
        <button type="submit" class="btn" style="background-color: aqua; color: #ffffff;">Sell</button>
        <a href="{% url 'main:display' %}" class="btn btn-secondary">Cancel</a>
      </div>
    </div>
  </form>

  <!-- Message display -->
  <div id="messageBox" class="mt-3"></div>
</div>

<script>
document.addEventListener("DOMContentLoaded", () => {
  const form = document.querySelector("#productForm");
  const msgBox = document.querySelector("#messageBox");

  form.addEventListener("submit", async (e) => {
    e.preventDefault();

    const formData = new FormData(form);

    const res = await fetch("{% url 'main:add_product_ajax' %}", {
      method: "POST",
      body: formData,
    });

    if (res.ok) {
      msgBox.innerHTML = `<div class="alert alert-success">Product added successfully!</div>`;
      form.reset();

      // Optional: notify main display to refresh
      document.dispatchEvent(new CustomEvent("productAdded"));
    } else {
      msgBox.innerHTML = `<div class="alert alert-danger">Failed to add product (Error ${res.status}).</div>`;
    }
  });
});
</script>
{% endblock content %}
